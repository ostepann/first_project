# backtest_platform/strategies/trading_logics/base_logic.py

"""
Базовый модуль для реализации паттерна "Стратегия" в торговой логике.

Этот файл определяет абстрактный интерфейс, которому должны следовать все 
конкретные реализации логики выбора актива (например, "голый момент", 
адаптивная стратегия и т.д.).

ПРЕИМУЩЕСТВА ПОДХОДА:
- **Модульность**: Каждая логика изолирована в своём классе.
- **Тестируемость**: Легко писать unit-тесты для каждой логики отдельно.
- **Расширяемость**: Добавление новой логики не требует изменения существующего кода.
"""

from abc import ABC, abstractmethod
import pandas as pd

class TradingLogic(ABC):
    """
    Абстрактный базовый класс для всех реализаций торговой логики.

    Этот класс задаёт контракт: любой наследник обязан реализовать метод 
    `select_best_asset`. Это гарантирует, что основной класс стратегии 
    (`DualMomentumStrategy`) сможет работать с любой конкретной логикой 
    единообразно, не зная её внутреннего устройства.

    Атрибуты:
        risk_free_ticker (str): Тикер актива без риска (кэш), используемый по умолчанию.
    """

    def __init__(self, risk_free_ticker: str, **kwargs):
        """
        Инициализирует базовую логику.

        Args:
            risk_free_ticker (str): Тикер кэш-актива (например, 'LQDT').
            **kwargs: Любые дополнительные параметры, которые могут понадобиться 
                     конкретной реализации логики (например, окна, пороги). 
                     Они будут сохранены как атрибуты экземпляра.
        """
        self.risk_free_ticker = risk_free_ticker
        # Динамически сохраняем все переданные параметры как атрибуты класса.
        # Это позволяет избежать жёсткой привязки к конкретному набору параметров
        # и делает класс более гибким.
        for key, value in kwargs.items():
            setattr(self, key, value)

    @abstractmethod
    def select_best_asset(self, data_dict: dict[str, pd.DataFrame]) -> str:
        """
        Абстрактный метод для выбора лучшего актива.

        Эта функция является ядром любой торговой логики. Она получает на вход 
        данные по всем доступным активам и должна вернуть тикер того актива, 
        который, по мнению этой логики, является наилучшим для покупки на текущий момент.

        Args:
            data_dict (dict[str, pd.DataFrame]): Словарь, где ключ - тикер актива,
                а значение - DataFrame с его историческими данными (должен содержать колонку 'CLOSE').

        Returns:
            str: Тикер выбранного актива. Если ни один актив не подходит, 
                 должен быть возвращён `risk_free_ticker`.
        """
        pass